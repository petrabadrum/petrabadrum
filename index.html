<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Petrabadrum ‚Äì Offertapp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --petra-dark: #003c8f;
      --petra-main: #1d4ed8;
      --petra-light: #e2e8f0;
      --bg-body: #f3f4f6;
      --pill-bg: #f8fafc;
      --pill-border: #cbd5e1;
      --pill-green-bg: #e7f7ec;
      --pill-green-border: #7ac897;
      --pill-green-text: #065f46;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, system-ui, -webkit-system-font, sans-serif;
      background: var(--bg-body);
      color: #0f172a;
      font-size: 16px;
    }

    /* SPLASH / F√ñRSTASIDA */
    #splash {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: #ffffff;
      text-align: center;
      padding: 40px 16px 24px;
    }
    #splash-logo {
      width: 210px;
      max-width: 70%;
      height: auto;
      margin-bottom: 24px;
    }
    #splash-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 40px;
    }
    #splash-arrow {
      font-size: 24px;
      opacity: 0.4;
      animation: bounce 1.2s infinite;
      margin-top: 32px;
    }
    @keyframes bounce {
      0%,100% { transform: translateY(0); }
      50%     { transform: translateY(6px); }
    }

    /* HUVUDAPP */
    #app {
      padding: 0 12px 40px;
      max-width: 900px;
      margin: 0 auto;
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 16px 16px 18px;
      margin-bottom: 14px;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.12);
      border: 1px solid #dde3ee;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    h2 {
      font-size: 18px;
      margin: 0;
      color: var(--petra-dark);
      font-weight: 700;
    }

    .section-caption {
      font-size: 12px;
      color: #64748b;
      margin-bottom: 10px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .field-group { margin-bottom: 10px; }

    .field-label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #1e293b;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    textarea {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      background: #f8fafc;
      padding: 10px 14px;
      font-size: 15px;
      min-height: 44px;
    }

    input[type="date"],
    input[type="time"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      background: #f8fafc;
      padding: 10px 14px;
      font-size: 15px;
      min-height: 44px;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }

    textarea {
      border-radius: 14px;
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    .pill-select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--pill-border);
      background: var(--pill-bg);
      padding: 10px 14px;
      font-size: 15px;
      min-height: 44px;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      position: relative;
      color: #0f172a;
      font-weight: 500;
      background-image: linear-gradient(45deg, transparent 50%, #64748b 50%),
        linear-gradient(135deg, #64748b 50%, transparent 50%);
      background-position: calc(100% - 18px) 17px, calc(100% - 13px) 17px;
      background-size: 5px 5px, 5px 5px;
      background-repeat: no-repeat;
    }
    .pill-select.filled {
      background: var(--pill-green-bg);
      border-color: var(--pill-green-border);
      color: var(--pill-green-text);
    }

    .calendar-btn {
      border-radius: 999px;
      border: none;
      background: #fbbf24;
      color: #78350f;
      font-weight: 700;
      font-size: 13px;
      padding: 8px 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 6px 15px rgba(217, 119, 6, 0.4);
      cursor: pointer;
      white-space: nowrap;
    }
    .calendar-btn span.icon { font-size: 18px; }

    .checkbox-row {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      gap: 8px;
    }
    .checkbox-row input[type="checkbox"] {
      transform: scale(1.1);
    }
    .checkbox-row label {
      font-size: 14px;
      color: #111827;
    }

    .chip-group-label {
      font-size: 14px;
      font-weight: 600;
      color: #1e293b;
      margin: 10px 0 4px;
    }

    .small {
      font-size: 12px;
      color: #6b7280;
    }

    .price-box {
      font-size: 22px;
      font-weight: 700;
      color: var(--petra-dark);
      margin-bottom: 4px;
    }

    .price-details {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .btn {
      flex: 1 1 calc(50% - 4px);
      border-radius: 999px;
      border: none;
      padding: 13px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
    }

    .btn-primary { background: var(--petra-main); color: #ffffff; }
    .btn-secondary { background: #e5e7eb; color: #111827; }
    .btn-outline {
      background: #ffffff;
      border: 1px solid var(--petra-main);
      color: var(--petra-main);
    }

    .btn-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-icon span { font-size: 18px; }

    .entre-card {
      background: #020617;
      color: #e5e7eb;
      border-color: #0f172a;
    }
    .entre-card h2 { color: #bfdbfe; }
    .entre-card textarea {
      background: #020617;
      color: #e5e7eb;
      border-color: #1f2933;
    }

    @media (max-width: 640px) {
      .grid-2 { grid-template-columns: 1fr 1fr; }
    }

    @media print {
      #splash { display: none; }
      body { background: #ffffff; }
      .btn-row,
      .calendar-btn,
      #foto_info {
        display: none !important;
      }
      .card {
        box-shadow: none;
        border-color: #cbd5e1;
      }
    }
  </style>
</head>
<body>

<section id="splash">
  <img id="splash-logo" src="petrabygg_logo.png" alt="Petra Bygg & Renovering AB" />
  <div id="splash-title">Offertunderlag f√∂r badrumsrenovering</div>
  <div class="small">Skrolla ned f√∂r att fylla i kunduppgifter och r√§kna fram prelimin√§rt pris.</div>
  <div id="splash-arrow">‚¨áÔ∏é</div>
</section>

<div id="app">

  <!-- KUNDUPPGIFTER & M√ñTESDATA -->
  <div class="card">
    <div class="card-header">
      <h2>Kunduppgifter</h2>
      <button type="button" class="calendar-btn" onclick="l√§ggTillIKalender()">
        <span class="icon">üìÖ</span>
        L√§gg till i kalender
      </button>
    </div>
    <div class="section-caption">
      Fylls i vid f√∂rsta telefonkontakten och inf√∂r kundbes√∂k.
    </div>

    <div class="grid-2">
      <div class="field-group">
        <div class="field-label">Kundnamn</div>
        <input id="kundnamn" type="text" placeholder="Ex. Anna Andersson" />
      </div>
      <div class="field-group">
        <div class="field-label">Adress</div>
        <input id="adress" type="text" placeholder="Gata, postnummer, ort" />
      </div>
      <div class="field-group">
        <div class="field-label">Telefon</div>
        <input id="telefon" type="tel" />
      </div>
      <div class="field-group">
        <div class="field-label">E-post</div>
        <input id="epost" type="email" />
      </div>
    </div>

    <div class="field-group">
      <div class="field-label">M√∂tesdata</div>
    </div>
    <div class="grid-2">
      <div class="field-group">
        <div class="field-label">Datum f√∂r kundbes√∂k</div>
        <input id="mote_datum"
               type="text"
               placeholder="Datum"
               onfocus="this.type='date';"
               onblur="if(!this.value){this.type='text';}" />
      </div>
      <div class="field-group">
        <div class="field-label">Tid</div>
        <input id="mote_tid"
               type="text"
               placeholder="Tid"
               onfocus="this.type='time';"
               onblur="if(!this.value){this.type='text';}" />
      </div>
      <div class="field-group">
        <div class="field-label">M√∂testyp</div>
        <select id="motestyp" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="f√∂rsta_bes√∂k">F√∂rsta bes√∂k</option>
          <option value="√•terbes√∂k">√Öterbes√∂k</option>
          <option value="digitalt">Digitalt m√∂te</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Plats (adress/online)</div>
        <input id="mote_plats" type="text" placeholder="Hos kund, adress eller Teams-l√§nk" />
      </div>
    </div>

    <div class="field-group">
      <div class="field-label">R√∂sttranskribering</div>
      <div class="btn-row">
        <button type="button" class="btn btn-secondary"
                onclick="visaTranskribering('telefonsamtal')">
          Telefonsamtal
        </button>
        <button type="button" class="btn btn-secondary"
                onclick="visaTranskribering('m√∂te')">
          M√∂te p√• plats
        </button>
      </div>
      <div class="small" style="margin-top:4px;">
        Obs: Sj√§lva inspelningen g√∂rs i en separat app i telefonen. Den h√§r knappen visar instruktioner
        och kan √∂ppna din transkriberings-tj√§nst.
      </div>
    </div>
  </div>

  <!-- BADRUMSDATA -->
  <div class="card">
    <h2>Badrumsdata</h2>
    <div class="grid-2">
      <div class="field-group">
        <div class="field-label">Niv√•</div>
        <select id="niv√•" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="standard">Standard</option>
          <option value="premium">Premium</option>
          <option value="exklusiv">Exklusiv</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Storlek (m¬≤)</div>
        <select id="storlek" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="4">4 m¬≤</option>
          <option value="5">5 m¬≤</option>
          <option value="6">6 m¬≤</option>
          <option value="7">7 m¬≤</option>
          <option value="8">8 m¬≤</option>
          <option value="9">9 m¬≤</option>
          <option value="10">10 m¬≤</option>
          <option value="12">12 m¬≤</option>
          <option value="15">15 m¬≤</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Takh√∂jd (m)</div>
        <select id="takh√∂jd" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="2.2">2,2 m</option>
          <option value="2.3">2,3 m</option>
          <option value="2.4">2,4 m</option>
          <option value="2.5">2,5 m</option>
          <option value="2.6">2,6 m</option>
          <option value="2.7">2,7 m</option>
          <option value="2.8">2,8 m</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Reserv</div>
        <select id="badrum_reserv" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="planl√∂sning">Planl√∂snings√§ndring</option>
          <option value="extra_m2">Extra m¬≤</option>
        </select>
      </div>
    </div>
  </div>

  <!-- YTSKIKT -->
  <div class="card">
    <h2>Ytskikt</h2>
    <div class="grid-2">
      <div class="field-group">
        <div class="field-label">Kakelstorlek v√§gg</div>
        <input id="kakel_v√§gg" type="text" placeholder="Ex. 30x60" />
      </div>
      <div class="field-group">
        <div class="field-label">Fogf√§rg</div>
        <input id="fogf√§rg" type="text" />
      </div>
      <div class="field-group">
        <div class="field-label">Klinker storlek golv</div>
        <input id="klinker_golv" type="text" placeholder="Ex. 10x10" />
      </div>
      <div class="field-group">
        <div class="field-label">Reserv</div>
        <select id="ytskikt_reserv" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="halvf√∂rband">Halvf√∂rband</option>
          <option value="stens√§ttning">Stens√§ttning / m√∂nster</option>
        </select>
      </div>
    </div>
  </div>

  <!-- FUNKTIONER & UTRUSTNING -->
  <div class="card">
    <h2>Funktioner & utrustning</h2>

    <div class="chip-group-label">Sanitet & dusch</div>
    <div class="grid-2">
      <div class="field-group">
        <div class="checkbox-row">
          <input id="wc_v√§gg" type="checkbox" />
          <label for="wc_v√§gg">V√§ggh√§ngd toalett</label>
        </div>
        <div class="checkbox-row">
          <input id="badkar" type="checkbox" />
          <label for="badkar">Badkar</label>
        </div>
        <div class="checkbox-row">
          <input id="enbart_dusch" type="checkbox" />
          <label for="enbart_dusch">Enbart dusch</label>
        </div>
      </div>
      <div class="field-group">
        <div class="checkbox-row">
          <input id="tv√§ttmaskin" type="checkbox" />
          <label for="tv√§ttmaskin">Tv√§ttmaskin inkl el &amp; avlopp</label>
        </div>
        <div class="checkbox-row">
          <input id="ny_d√∂rr" type="checkbox" />
          <label for="ny_d√∂rr">Ny d√∂rr</label>
        </div>
        <div class="checkbox-row">
          <input id="ny_tr√∂skel" type="checkbox" />
          <label for="ny_tr√∂skel">Ny tr√∂skel</label>
        </div>
      </div>
    </div>

    <div class="chip-group-label">Inredning & nischer</div>
    <div class="grid-2">
      <div class="field-group">
        <div class="field-label">Nischer i v√§ggar (antal)</div>
        <select id="nischer" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="0">0</option><option value="1">1</option>
          <option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Antal tv√§ttst√§ll</div>
        <select id="antal_tvattstall" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="1">1</option><option value="2">2</option><option value="3">3</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Antal duschset</div>
        <select id="antal_duschset" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="1">1</option><option value="2">2</option><option value="3">3</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Ny v√§gg (m¬≤)</div>
        <input id="ny_vagg_m2" type="text" />
      </div>
    </div>

    <div class="chip-group-label">R√∂r, v√§rme & el</div>
    <div class="grid-2">
      <div class="field-group">
        <div class="field-label">Vattenledningar</div>
        <select id="vattenledningar" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="utan">Utanp√•liggande</option>
          <option value="inf√§llda">Inf√§llda</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Golvv√§rme</div>
        <select id="golvv√§rme" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="ingen">Ingen</option>
          <option value="el">El</option>
          <option value="vatten">Vatten</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Handdukstork</div>
        <select id="handdukstork" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="ingen">Ingen</option>
          <option value="el">El</option>
          <option value="vatten">Vatten</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Antal spotlights</div>
        <select id="spotlights" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="0">0</option><option value="2">2</option>
          <option value="4">4</option><option value="6">6</option>
          <option value="8">8</option><option value="10">10</option>
        </select>
      </div>
    </div>

    <div class="chip-group-label">Byggdelar</div>
    <div class="grid-2">
      <div class="field-group">
        <div class="field-label">Golvavlopp</div>
        <select id="golvavlopp" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="trad">Traditionellt</option>
          <option value="unidrain">Unidrain</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">Reserv</div>
        <select id="bygg_reserv" class="pill-select">
          <option value="ej_valt">Ej valt</option>
          <option value="stomkomp">Stomkomplettering</option>
          <option value="s√§nkning_golv">S√§nkning/uppbyggnad golv</option>
        </select>
      </div>
    </div>

    <div class="chip-group-label">Badrumsinredning (kund k√∂per, vi installerar)</div>
    <div class="grid-2">
      <div class="field-group">
        <div class="checkbox-row">
          <input id="inred_kommod" type="checkbox" />
          <label for="inred_kommod">Kommod</label>
        </div>
        <div class="checkbox-row">
          <input id="inred_spegel" type="checkbox" />
          <label for="inred_spegel">Spegelsk√•p/spegel</label>
        </div>
        <div class="checkbox-row">
          <input id="inred_hogskap" type="checkbox" />
          <label for="inred_hogskap">H√∂gsk√•p</label>
        </div>
      </div>
      <div class="field-group">
        <div class="checkbox-row">
          <input id="inred_forkast" type="checkbox" />
          <label for="inred_forkast">F√∂rvaring toalett</label>
        </div>
        <div class="checkbox-row">
          <input id="inred_handdusch" type="checkbox" />
          <label for="inred_handdusch">Handdusch</label>
        </div>
      </div>
    </div>

    <div class="chip-group-label">Duschl√∂sning</div>
    <div class="grid-2">
      <div class="field-group">
        <div class="checkbox-row"><input id="dusch_horna" type="checkbox" /><label for="dusch_horna">Duschh√∂rna</label></div>
        <div class="checkbox-row"><input id="dusch_fastglas" type="checkbox" /><label for="dusch_fastglas">Fast glasv√§gg</label></div>
        <div class="checkbox-row"><input id="dusch_vikdorr" type="checkbox" /><label for="dusch_vikdorr">Vikd√∂rrar</label></div>
      </div>
      <div class="field-group">
        <div class="checkbox-row"><input id="dusch_skjut" type="checkbox" /><label for="dusch_skjut">Skjutd√∂rr</label></div>
        <div class="checkbox-row"><input id="dusch_walkin" type="checkbox" /><label for="dusch_walkin">Walk-in</label></div>
      </div>
    </div>

    <div class="chip-group-label">Logistik</div>
    <div class="field-group">
      <div class="checkbox-row">
        <input id="hamta_kakel" type="checkbox" />
        <label for="hamta_kakel">Vi h√§mtar kakel &amp; klinker √•t kund</label>
      </div>
      <div class="checkbox-row">
        <input id="hamta_inredning" type="checkbox" />
        <label for="hamta_inredning">Vi h√§mtar badrumsinredning √•t kund</label>
      </div>
    </div>

    <div class="chip-group-label">√ñvrigt (t.ex. speciella √∂nskem√•l, tr√•nga utrymmen etc.)</div>
    <textarea id="ovrigt_text" placeholder="Skriv ev. s√§rskilda f√∂ruts√§ttningar h√§r..."></textarea>
  </div>

  <!-- PRIS & OFFERTUNDERLAG -->
  <div class="card">
    <h2>Prelimin√§rt pris & offertunderlag</h2>
    <p class="small">
      Prisniv√•er nedan √§r prelimin√§ra (exkl. eventuella till√§ggs- och √§ndringsarbeten).
      Slutlig offert tas fram av Petra Hus AB.
    </p>

    <div id="pris_text" class="price-box">‚Äì</div>
    <div id="pris_detaljer" class="price-details"></div>

    <div id="foto_info" class="small" style="margin-top:6px;">
      Tips: Ta bilder/film i kundens badrum och bifoga n√§r du mailar underlaget till entrepren√∂ren.
    </div>

    <div class="btn-row">
      <button class="btn btn-secondary btn-icon" onclick="√∂ppnaKamera('image')">
        <span>üì∑</span> Ta foto
      </button>
      <button class="btn btn-secondary btn-icon" onclick="√∂ppnaKamera('video')">
        <span>üé•</span> Filma
      </button>
    </div>

    <input id="foto_input" type="file" accept="image/*" capture="environment" multiple style="display:none;" />
    <input id="video_input" type="file" accept="video/*" capture="environment" style="display:none;" />

    <div class="btn-row" style="margin-top:10px;">
      <button class="btn btn-primary" onclick="ber√§knaPris()">Ber√§kna pris</button>
      <button class="btn btn-secondary" onclick="kopieraSammanfattning()">Kopiera sammanfattning</button>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="skapaPDF()">Skapa PDF (skriv ut)</button>
      <button class="btn btn-outline" onclick="skickaMail()">Maila offertunderlag</button>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="sparaArendeFil()">Spara √§rende (fil)</button>
    </div>

    <textarea id="sammanfattning" style="margin-top:8px;" rows="8"
              placeholder="H√§r visas sammanfattningen till kund/offertsystem..."></textarea>
  </div>

  <!-- ENTREPREN√ñRSVY -->
  <div class="card entre-card">
    <h2>Entrepren√∂rsvy ‚Äì PETRA HUS AB</h2>
    <p class="small">
      Denna vy kan kopieras och skickas till Petra Hus eller anv√§ndas som underlag vid inmatning
      i deras offertsystem. Kom ih√•g att separat bifoga bilder/video.
    </p>
    <textarea id="entre_sammanfattning" rows="10"
              placeholder="Ber√§kna pris f√∂rst, s√• fylls entrepren√∂rsvyn i automatiskt."></textarea>
  </div>

</div>

<script>
  // ======= PRISDATA =======
  const priser = {
    BASE_STD_M2: 10000,
    BASE_PREM_M2: 14500,
    BASE_EXKL_M2: 19500,
    WC_V√ÑGG:      12000,
    GOLVV_EL_M2:   1800,
    GOLVV_VAT_M2:  2100,
    UNIDRAIN:      8000,
    NISCH:         4000,
    TV√ÑTT:         6000,
    GLAS:          9000,
    HANDDUK_EL:    4000,
    HANDDUK_VAT:   5000,
    SPOT:          1100,
    UNDERTAK:      6000,
    HAMTA_KAKEL:     2500,
    HAMTA_INREDNING: 2500,
    OVRIGT_FAST: 30000
  };

  function formatCurrency(value) {
    if (isNaN(value)) return "-";
    return value.toLocaleString("sv-SE", {
      style: "currency",
      currency: "SEK",
      maximumFractionDigits: 0
    });
  }

  function √∂ppnaKamera(typ) {
    if (typ === "image") {
      document.getElementById("foto_input").click();
    } else {
      document.getElementById("video_input").click();
    }
  }

  function ber√§knaPris() {
    const m2Val = document.getElementById("storlek").value;
    const m2 = m2Val === "ej_valt" ? 0 : parseFloat(m2Val) || 0;

    const wcV√§gg     = document.getElementById("wc_v√§gg").checked;
    const golvv√§rme  = document.getElementById("golvv√§rme").value;
    const nischer    = parseInt(document.getElementById("nischer").value === "ej_valt" ? "0" : document.getElementById("nischer").value) || 0;
    const tv√§tt      = document.getElementById("tv√§ttmaskin").checked;
    const golvavlopp = document.getElementById("golvavlopp").value;
    const handduk    = document.getElementById("handdukstork").value;
    const spotsVal   = document.getElementById("spotlights").value;
    const spots      = spotsVal === "ej_valt" ? 0 : parseInt(spotsVal) || 0;
    const undertak   = false; // nytt undertak finns kvar i pris-listan om du vill koppla p√• senare
    const niv√•       = document.getElementById("niv√•").value;
    const hamtaKakel = document.getElementById("hamta_kakel").checked;
    const hamtaInred = document.getElementById("hamta_inredning").checked;

    const duschVal = [
      {id: "dusch_horna",   label: "Duschh√∂rna"},
      {id: "dusch_fastglas",label: "Fast glasv√§gg"},
      {id: "dusch_vikdorr", label: "Vikd√∂rrar"},
      {id: "dusch_skjut",   label: "Skjutd√∂rr"},
      {id: "dusch_walkin",  label: "Walk-in"}
    ].filter(x => document.getElementById(x.id).checked).map(x => x.label);

    let sumEx = 0;
    let rader = [];

    if (m2 > 0 && (niv√• === "standard" || niv√• === "premium" || niv√• === "exklusiv")) {
      let kod;
      if (niv√• === "standard")  kod = "BASE_STD_M2";
      if (niv√• === "premium")   kod = "BASE_PREM_M2";
      if (niv√• === "exklusiv")  kod = "BASE_EXKL_M2";
      const √°pris = priser[kod];
      const belopp = m2 * √°pris;
      sumEx += belopp;
      const niv√•Text = niv√•.charAt(0).toUpperCase() + niv√•.slice(1);
      rader.push("Basrenovering " + niv√•Text + " " + m2.toFixed(1) + " m¬≤: " + formatCurrency(belopp));
    }

    if (wcV√§gg) {
      sumEx += priser.WC_V√ÑGG;
      rader.push("Installation av v√§ggh√§ngd WC inkl fixtur: " + formatCurrency(priser.WC_V√ÑGG));
    }

    if (golvv√§rme === "el" && m2 > 0) {
      const belopp = m2 * priser.GOLVV_EL_M2;
      sumEx += belopp;
      rader.push("Golvv√§rme (el) " + m2.toFixed(1) + " m¬≤: " + formatCurrency(belopp));
    } else if (golvv√§rme === "vatten" && m2 > 0) {
      const belopp = m2 * priser.GOLVV_VAT_M2;
      sumEx += belopp;
      rader.push("Golvv√§rme (vatten) " + m2.toFixed(1) + " m¬≤: " + formatCurrency(belopp));
    }

    if (golvavlopp === "unidrain") {
      sumEx += priser.UNIDRAIN;
      rader.push("Unidrain golvavlopp (material + installation): " + formatCurrency(priser.UNIDRAIN));
    }

    if (nischer > 0) {
      const belopp = nischer * priser.NISCH;
      sumEx += belopp;
      rader.push("Platsbyggda nischer " + nischer + " st: " + formatCurrency(belopp));
    }

    if (tv√§tt) {
      sumEx += priser.TV√ÑTT;
      rader.push("Installation av tv√§ttmaskin (el & avlopp): " + formatCurrency(priser.TV√ÑTT));
    }

    if (duschVal.length > 0) {
      sumEx += priser.GLAS;
      rader.push("Montering av dusch-/glasl√∂sning: " + formatCurrency(priser.GLAS));
    }

    if (handduk === "el") {
      sumEx += priser.HANDDUK_EL;
      rader.push("Installation av handdukstork (el): " + formatCurrency(priser.HANDDUK_EL));
    } else if (handduk === "vatten") {
      sumEx += priser.HANDDUK_VAT;
      rader.push("Installation av handdukstork (vatten): " + formatCurrency(priser.HANDDUK_VAT));
    }

    if (spots > 0) {
      const belopp = spots * priser.SPOT;
      sumEx += belopp;
      rader.push("Spotlights " + spots + " st: " + formatCurrency(belopp));
    }

    if (undertak) {
      sumEx += priser.UNDERTAK;
      rader.push("Nytt undertak/s√§nkt tak: " + formatCurrency(priser.UNDERTAK));
    }

    if (hamtaKakel) {
      sumEx += priser.HAMTA_KAKEL;
      rader.push("H√§mtning/transport av kakel & klinker: " + formatCurrency(priser.HAMTA_KAKEL));
    }
    if (hamtaInred) {
      sumEx += priser.HAMTA_INREDNING;
      rader.push("H√§mtning/transport av badrumsinredning: " + formatCurrency(priser.HAMTA_INREDNING));
    }

    if (m2 > 0) {
      sumEx += priser.OVRIGT_FAST;
      rader.push("√ñvrigt (etablering, resor, deponi etc): " + formatCurrency(priser.OVRIGT_FAST));
    }

    const sumInkl = sumEx * 1.25;

    if (sumEx > 0) {
      document.getElementById("pris_text").innerText =
        formatCurrency(sumInkl) + " inkl moms (prelimin√§rt)";
      document.getElementById("pris_detaljer").innerText =
        "Exkl moms: " + formatCurrency(sumEx) +
        " ‚Ä¢ Moms 25%: " + formatCurrency(sumInkl - sumEx);
    } else {
      document.getElementById("pris_text").innerText = "‚Äì";
      document.getElementById("pris_detaljer").innerText = "";
    }

    byggSammanfattning(sumInkl, sumEx, rader);
    saveState();
  }

  function byggSammanfattning(sumInkl, sumEx, prisrader) {
    const kund = document.getElementById("kundnamn").value;
    const adress = document.getElementById("adress").value;
    const tel = document.getElementById("telefon").value;
    const epost = document.getElementById("epost").value;

    const niv√• = document.getElementById("niv√•").value;
    const m2 = document.getElementById("storlek").value;
    const tak = document.getElementById("takh√∂jd").value;
    const kakel = document.getElementById("kakel_v√§gg").value;
    const fog = document.getElementById("fogf√§rg").value;
    const klinker = document.getElementById("klinker_golv").value;

    const wcV√§gg = document.getElementById("wc_v√§gg").checked ? "Ja" : "Nej";
    const badkar = document.getElementById("badkar").checked ? "Ja" : "Nej";
    const enbartDusch = document.getElementById("enbart_dusch").checked ? "Ja" : "Nej";
    const tv√§tt = document.getElementById("tv√§ttmaskin").checked ? "Ja" : "Nej";
    const nischer = document.getElementById("nischer").value === "ej_valt" ? "0" : (document.getElementById("nischer").value || "0");
    const tvattst = document.getElementById("antal_tvattstall").value === "ej_valt" ? "1" : (document.getElementById("antal_tvattstall").value || "1");
    const duschset = document.getElementById("antal_duschset").value === "ej_valt" ? "1" : (document.getElementById("antal_duschset").value || "1");
    const vattenledningar = document.getElementById("vattenledningar").value;
    const golvv√§rme = document.getElementById("golvv√§rme").value;
    const handduk = document.getElementById("handdukstork").value;
    const spots = document.getElementById("spotlights").value === "ej_valt" ? "0" : (document.getElementById("spotlights").value || "0");
    const golvavlopp = document.getElementById("golvavlopp").value === "unidrain" ? "Unidrain" : "Traditionellt";
    const nyVagg = document.getElementById("ny_vagg_m2").value || "0";
    const hamtaKakel = document.getElementById("hamta_kakel").checked ? "Ja" : "Nej";
    const hamtaInred = document.getElementById("hamta_inredning").checked ? "Ja" : "Nej";
    const ovrigtText = document.getElementById("ovrigt_text").value;

    const handduschWC = "Ej specificerad";

    const inredVal = [
      {id:"inred_kommod", label:"Kommod"},
      {id:"inred_spegel", label:"Spegelsk√•p/spegel"},
      {id:"inred_hogskap", label:"H√∂gsk√•p"},
      {id:"inred_forkast", label:"F√∂rvaring toalett"},
      {id:"inred_handdusch", label:"Handdusch"}
    ].filter(x => document.getElementById(x.id).checked).map(x => x.label);

    const duschVal = [
      {id: "dusch_horna",   label: "Duschh√∂rna"},
      {id: "dusch_fastglas",label: "Fast glasv√§gg"},
      {id: "dusch_vikdorr", label: "Vikd√∂rrar"},
      {id: "dusch_skjut",   label: "Skjutd√∂rr"},
      {id: "dusch_walkin",  label: "Walk-in"}
    ].filter(x => document.getElementById(x.id).checked).map(x => x.label);

    let niv√•Text = niv√• && niv√• !== "ej_valt"
      ? niv√•.charAt(0).toUpperCase() + niv√•.slice(1)
      : "Ej vald";

    let text = "";
    text += "Kund: " + (kund || "-") + "\n";
    text += "Adress: " + (adress || "-") + "\n";
    if (tel) text += "Telefon: " + tel + "\n";
    if (epost) text += "E-post: " + epost + "\n";
    text += "\n";

    text += "Standardniv√•: " + niv√•Text + "\n";
    text += "Badrum ca " + (m2 || "?") + " m¬≤, takh√∂jd " + (tak || "?") + " m.\n";
    text += "Ytskikt: v√§ggkakel " + (kakel || "?") + ", fogf√§rg " + (fog || "?") +
            ", klinker golv " + (klinker || "?") + ".\n\n";

    text += "Funktioner och utrustning:\n";
    text += "- V√§ggh√§ngd WC: " + wcV√§gg + "\n";
    text += "- Badkar: " + badkar + "\n";
    text += "- Enbart dusch: " + enbartDusch + "\n";
    text += "- Nischer i v√§ggar: " + nischer + " st\n";
    text += "- Antal tv√§ttst√§ll: " + tvattst + "\n";
    text += "- Antal duschset: " + duschset + "\n";
    text += "- Tv√§ttmaskin inkl el & avlopp: " + tv√§tt + "\n";
    text += "- Vattenledningar: " + vattenledningar + "\n";
    text += "- Golvv√§rme: " + golvv√§rme + "\n";
    text += "- Handdukstork: " + handduk + "\n";
    text += "- Antal spotlights: " + spots + "\n";
    text += "- Ny v√§gg: " + nyVagg + " m¬≤\n";
    text += "- Golvavlopp: " + golvavlopp + "\n";
    text += "- Vi h√§mtar kakel & klinker: " + hamtaKakel + "\n";
    text += "- Vi h√§mtar badrumsinredning: " + hamtaInred + "\n";
    text += "- Badrumsinredning: " + (inredVal.length ? inredVal.join(", ") : "-") + "\n";
    text += "- Duschl√∂sning: " + (duschVal.length ? duschVal.join(", ") : "-") + "\n";
    text += "- Handdusch vid toalett: " + handduschWC + "\n\n";

    if (ovrigtText.trim().length > 0) {
      text += "√ñvrigt (s√§rskilda f√∂ruts√§ttningar):\n" + ovrigtText.trim() + "\n\n";
    }

    if (prisrader && prisrader.length > 0) {
      text += "Prisuppdelning (prelimin√§r, exkl moms):\n";
      prisrader.forEach(rad => text += "- " + rad + "\n");
      text += "\n";
    }

    if (!isNaN(sumInkl) && sumInkl > 0) {
      text += "Prelimin√§rt totalpris (exkl moms): " + formatCurrency(sumEx) + "\n";
      text += "Prelimin√§rt totalpris (inkl moms): " + formatCurrency(sumInkl) + ".\n";
      text += "Observera att detta √§r ett ungef√§rligt pris baserat p√• standardutf√∂rande. Slutlig offert l√§mnas efter genomg√•ng av alla detaljer.\n\n";
    } else {
      text += "Prelimin√§rt pris har inte ber√§knats √§nnu.\n\n";
    }

    const entrepren√∂rAnsvar =
      "Entrepren√∂rens ansvar:\n" +
      "- Rivning av befintligt badrum\n" +
      "- Eventuell flytt av r√∂r/nya r√∂r\n" +
      "- Eventuell uppriktning av v√§ggar\n" +
      "- Eventuell montering av nytt undergolv\n" +
      "- Ink√∂p av r√∂rmaterial\n" +
      "- Ink√∂p av elmaterial\n" +
      "- Eventuellt ink√∂p av undergolv (sp√•nskivor)\n" +
      "- Eventuellt ink√∂p av gipsskivor till tak\n" +
      "- Ink√∂p av flytspackel\n" +
      "- Ink√∂p av t√§tskikt\n" +
      "- Ink√∂p av kakellim\n" +
      "- Ink√∂p av kakelfog\n" +
      "- Ink√∂p av mjukfog\n" +
      "- Eventuell montering av golvv√§rme\n" +
      "- Eventuellt ink√∂p av material till golvv√§rme\n" +
      "- Flytspackling\n" +
      "- Eventuell frakt av plattor och inredning\n" +
      "- Eventuell montering av nischer\n" +
      "- Eldragning\n" +
      "- Eventuell montering av spotlights\n" +
      "- Montering av t√§tskikt\n" +
      "- Montering av golvbrunnar\n" +
      "- Montering av plattor\n" +
      "- Eventuell spackling i tak\n" +
      "- Eventuellt ink√∂p av v√•trumsspackel\n" +
      "- Eventuell m√•lning i tak\n" +
      "- Eventuellt ink√∂p av v√•trumsf√§rg\n" +
      "- Fogning av plattor\n" +
      "- Deponi\n" +
      "- Montering av all badrumsinredning\n" +
      "- Eventuellt ink√∂p av d√∂rrtr√∂skel\n" +
      "- Eventuell montering av d√∂rrtr√∂skel\n" +
      "- Grovst√§dning\n\n";

    const kundAnsvar =
      "Kundens ansvar:\n" +
      "- K√∂p av kakel/klinker (vi kan ombes√∂rja frakten)\n" +
      "- K√∂p av all badrumsinredning (vi kan ombes√∂rja frakten)\n";

    text += entrepren√∂rAnsvar + kundAnsvar;

    document.getElementById("sammanfattning").value = text;

    let entre = "";
    entre += "PETRA HUS AB ‚Äì UNDERLAG F√ñR OFFERT\n";
    entre += "====================================\n\n";
    entre += "Kund: " + (kund || "-") + "\n";
    entre += "Adress: " + (adress || "-") + "\n";
    if (tel) entre += "Telefon: " + tel + "\n";
    if (epost) entre += "E-post: " + epost + "\n";
    entre += "\n";

    entre += "Standardniv√•: " + niv√•Text + "\n";
    entre += "Yta: " + (m2 || "?") + " m¬≤ ‚Ä¢ Takh√∂jd: " + (tak || "?") + " m\n";
    entre += "Golvavlopp: " + golvavlopp + "\n";
    entre += "Vattenledningar: " + vattenledningar + "\n";
    entre += "Golvv√§rme: " + golvv√§rme + "\n";
    entre += "Handdukstork: " + handduk + "\n";
    entre += "Spotlights: " + spots + " st\n";
    entre += "Nischer: " + nischer + " st\n";
    entre += "Antal tv√§ttst√§ll: " + tvattst + "\n";
    entre += "Antal duschset: " + duschset + "\n";
    entre += "WC v√§ggh√§ngd: " + wcV√§gg + "\n";
    entre += "Badkar: " + badkar + " ‚Ä¢ Enbart dusch: " + enbartDusch + "\n";
    entre += "Ny v√§gg: " + nyVagg + " m¬≤\n";
    entre += "Vi h√§mtar kakel & klinker: " + hamtaKakel + "\n";
    entre += "Vi h√§mtar badrumsinredning: " + hamtaInred + "\n\n";

    entre += "Ytskikt:\n";
    entre += "- Kakel v√§gg: " + (kakel || "-") + "\n";
    entre += "- Fogf√§rg: " + (fog || "-") + "\n";
    entre += "- Klinker golv: " + (klinker || "-") + "\n\n";

    entre += "Inredning:\n";
    entre += "- Badrumsinredning: " + (inredVal.length ? inredVal.join(", ") : "-") + "\n";
    entre += "- Duschl√∂sning: " + (duschVal.length ? duschVal.join(", ") : "-") + "\n\n";

    if (ovrigtText.trim().length > 0) {
      entre += "√ñvrigt/s√§rskilda f√∂ruts√§ttningar:\n" + ovrigtText.trim() + "\n\n";
    }

    if (prisrader && prisrader.length > 0) {
      entre += "Prisuppdelning (prelimin√§r, exkl moms):\n";
      prisrader.forEach(rad => entre += "- " + rad + "\n");
      entre += "\n";
    }

    if (!isNaN(sumInkl) && sumInkl > 0) {
      entre += "Prelimin√§rt totalpris exkl moms: " + formatCurrency(sumEx) + "\n";
      entre += "Prelimin√§rt totalpris inkl moms: " + formatCurrency(sumInkl) + "\n\n";
    } else {
      entre += "Prelimin√§rt pris ej ber√§knat.\n\n";
    }

    entre += entrepren√∂rAnsvar + kundAnsvar;
    entre += "\nNotering: Detta √§r ett underlag. Petra Hus AB justerar vid behov enligt egen kalkyl. " +
             "Bifoga √§ven bilder/video fr√•n bes√∂ket vid separat utskick.";

    document.getElementById("entre_sammanfattning").value = entre;
  }

  function kopieraSammanfattning() {
    const textarea = document.getElementById("sammanfattning");
    if (!textarea.value) ber√§knaPris();
    textarea.select();
    textarea.setSelectionRange(0, 99999);
    document.execCommand("copy");
    alert("Sammanfattning kopierad. Klistra in i sms, mail eller offertsystem.");
  }

  function skapaPDF() {
    if (!document.getElementById("sammanfattning").value) {
      ber√§knaPris();
    }
    window.print();
  }

  function skickaMail() {
    if (!document.getElementById("sammanfattning").value) {
      ber√§knaPris();
    }
    const kund = document.getElementById("kundnamn").value || "";
    const bodyText = document.getElementById("sammanfattning").value +
      "\n\nOBS: Bifoga √§ven bilder/video fr√•n bes√∂ket n√§r du skickar detta till entrepren√∂ren.";
    const body = encodeURIComponent(bodyText);
    const subject = encodeURIComponent("Offertunderlag badrumsrenovering ‚Äì " + kund);
    window.location.href = "mailto:?subject=" + subject + "&body=" + body;
  }

  // ======= TRANSKRIBERINGSTIPS =======
  // √Ñndra denna URL till din favorit-tj√§nst om du vill √∂ppna den direkt:
  const TRANSCRIPT_APP_URL = "";

  function visaTranskribering(typ) {
    let msg = "";
    if (typ === "telefonsamtal") {
      msg =
        "Inspelning av telefonsamtal m√•ste g√∂ras i en separat app i telefonen (iOS till√•ter " +
        "inte att webbsidor spelar in samtal direkt).\n\n" +
        "F√∂rslag p√• arbetsfl√∂de:\n" +
        "1) √ñppna din transkriberings-app.\n" +
        "2) Starta inspelning.\n" +
        "3) Ring kunden.\n" +
        "4) Efter samtalet ‚Äì spara och d√∂p inspelningen med kundens namn.\n";
    } else {
      msg =
        "F√∂r att spela in m√∂tet p√• plats kan du anv√§nda samma transkriberings-app i telefonen.\n\n" +
        "F√∂rslag p√• arbetsfl√∂de:\n" +
        "1) √ñppna appen innan m√∂tet.\n" +
        "2) Starta inspelning och l√§gg telefonen p√• bordet.\n" +
        "3) Efter m√∂tet ‚Äì stoppa inspelningen och spara.\n" +
        "4) Anv√§nd appens text-sammanfattning som komplement till denna offertapp.\n";
    }
    alert(msg);

    if (TRANSCRIPT_APP_URL) {
      window.open(TRANSCRIPT_APP_URL, "_blank");
    }
  }

  // ======= KALENDER (.ICS) =======
  function l√§ggTillIKalender() {
    const datum = document.getElementById("mote_datum").value;
    const tid = document.getElementById("mote_tid").value;
    if (!datum || !tid) {
      alert("Fyll i datum och tid f√∂r kundbes√∂ket f√∂rst.");
      return;
    }
    const kund = document.getElementById("kundnamn").value || "Kundbes√∂k";
    const plats = document.getElementById("mote_plats").value || "";
    const motestypVal = document.getElementById("motestyp").value;
    let motestypText = "Kundbes√∂k";
    if (motestypVal === "f√∂rsta_bes√∂k") motestypText = "F√∂rsta bes√∂k";
    else if (motestypVal === "√•terbes√∂k") motestypText = "√Öterbes√∂k";
    else if (motestypVal === "digitalt") motestypText = "Digitalt m√∂te";

    const start = new Date(datum + "T" + tid);
    const end = new Date(start.getTime() + 60 * 60 * 1000); // 1h

    function toICSDate(d) {
      const pad = n => (n < 10 ? "0" + n : "" + n);
      return (
        d.getFullYear().toString() +
        pad(d.getMonth() + 1) +
        pad(d.getDate()) + "T" +
        pad(d.getHours()) +
        pad(d.getMinutes()) +
        pad(d.getSeconds())
      );
    }

    const dtStart = toICSDate(start);
    const dtEnd = toICSDate(end);
    const now = toICSDate(new Date());
    const uid = "petrabadrum-" + Date.now() + "@petrabadrum";

    const ics =
      "BEGIN:VCALENDAR\n" +
      "VERSION:2.0\n" +
      "PRODID:-//Petrabadrum//SV\n" +
      "BEGIN:VEVENT\n" +
      "UID:" + uid + "\n" +
      "DTSTAMP:" + now + "\n" +
      "DTSTART:" + dtStart + "\n" +
      "DTEND:" + dtEnd + "\n" +
      "SUMMARY:" + motestypText + " ‚Äì " + kund + "\n" +
      (plats ? "LOCATION:" + plats + "\n" : "") +
      "DESCRIPTION:Kundbes√∂k bokat via Petrabadrum offertapp.\n" +
      "END:VEVENT\n" +
      "END:VCALENDAR";

    const blob = new Blob([ics], { type: "text/calendar;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "kundbes√∂k-" + kund.replace(/[^a-z0-9_-]+/gi, "_") + ".ics";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  // ======= LOCALSTORAGE (AUTOSAVE) =======
  const STORAGE_KEY = "petrabadrum_form_v3";

  function saveState() {
    const data = {};
    const elements = document.querySelectorAll("#app input, #app select, #app textarea");
    elements.forEach(el => {
      if (!el.id || el.type === "file") return;
      if (el.type === "checkbox") {
        data[el.id] = el.checked;
      } else {
        data[el.id] = el.value;
      }
    });
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    } catch (e) {
      console.warn("Kunde inte spara formul√§ret:", e);
    }
  }

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      const data = JSON.parse(raw);
      Object.keys(data).forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        if (el.type === "checkbox") {
          el.checked = !!data[id];
        } else {
          el.value = data[id];
        }
      });
    } catch (e) {
      console.warn("Kunde inte l√§sa formul√§ret:", e);
    }

    // √Öterst√§ll datum/tid-typ om v√§rde finns
    const d = document.getElementById("mote_datum");
    if (d && d.value) d.type = "date";
    const t = document.getElementById("mote_tid");
    if (t && t.value) t.type = "time";

    updateFilledPills();
  }

  function updateFilledPills() {
    document.querySelectorAll(".pill-select").forEach(sel => {
      const val = sel.value;
      if (val && val !== "ej_valt") {
        sel.classList.add("filled");
      } else {
        sel.classList.remove("filled");
      }
    });
  }

  function sparaArendeFil() {
    const data = {};
    const elements = document.querySelectorAll("#app input, #app select, #app textarea");
    elements.forEach(el => {
      if (!el.id || el.type === "file") return;
      if (el.type === "checkbox") {
        data[el.id] = el.checked;
      } else {
        data[el.id] = el.value;
      }
    });
    data.pris_text = document.getElementById("pris_text").innerText;
    data.pris_detaljer = document.getElementById("pris_detaljer").innerText;
    data.saved_at = new Date().toISOString();

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    const kund = (document.getElementById("kundnamn").value || "kund")
      .replace(/[^a-z0-9_-]+/gi, "_");
    a.download = "petrabadrum-" + kund + ".json";
    a.href = url;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadState();
    const elements = document.querySelectorAll("#app input, #app select, #app textarea");
    elements.forEach(el => {
      if (el.type === "file") return;
      el.addEventListener("input", () => {
        if (el.classList && el.classList.contains("pill-select")) updateFilledPills();
        saveState();
      });
      el.addEventListener("change", () => {
        if (el.classList && el.classList.contains("pill-select")) updateFilledPills();
        saveState();
      });
    });
  });
</script>

</body>
</html>

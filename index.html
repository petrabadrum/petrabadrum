<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Petrabadrum – Offertunderlag</title>

  <style>
    :root{
      --bg:#f2f5fb;
      --card:#ffffff;
      --line:#d9e1ef;
      --text:#0e1a2b;
      --muted:#6b7a90;
      --blue:#1f57d6;
      --btn:#eef2f7;
      --btnText:#1f2a3a;
      --okBg:#e6f4ea;
      --okBorder:#3b7a57;
      --shadow: 0 12px 30px rgba(17,38,78,.10);
      --radius:22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:18px 14px 60px;
    }

    .card{
      background:var(--card);
      border:1px solid rgba(217,225,239,.9);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      margin:14px 0;
    }

    .headRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom:8px;
    }
    h2{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
      color:#133a7a;
    }
    .sub{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }

    .topBtns{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .smallBtn{
      border:1px solid var(--line);
      background:#fff;
      color:#20314b;
      border-radius:999px;
      padding:9px 14px;
      font-weight:700;
      font-size:14px;
      cursor:pointer;
      box-shadow:0 8px 18px rgba(17,38,78,.06);
    }
    .smallBtn:active{transform:translateY(1px)}

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px 14px;
    }
    @media (max-width:760px){
      .grid2{grid-template-columns:1fr 1fr}
      .wrap{padding:14px 12px 60px}
    }
    @media (max-width:420px){
      .grid2{grid-template-columns:1fr}
    }

    label{
      display:block;
      font-weight:800;
      font-size:13px;
      color:#21314b;
      margin:2px 0 6px;
    }

    input[type="text"],
    input[type="tel"],
    input[type="email"],
    input[type="number"],
    select,
    textarea{
      width:100%;
      border:1px solid var(--line);
      background:#f8fbff;
      border-radius:16px;
      padding:14px 14px;
      font-size:16px;
      outline:none;
    }
    textarea{min-height:92px; resize:vertical}

    /* “Appiga” halvbreda valfält */
    .selectBtnWrap{
      position:relative;
    }
    .selectBtn{
      width:100%;
      appearance:none;
      -webkit-appearance:none;
      border:1px solid var(--line);
      background:var(--btn);
      color:var(--btnText);
      border-radius:18px;
      padding:16px 44px 16px 16px;
      font-size:18px;
      font-weight:800;
      cursor:pointer;
      line-height:1;
    }
    .selectBtn[data-chosen="1"]{
      background:var(--okBg);
      border-color:rgba(59,122,87,.55);
      color:#204a33;
    }
    .chev{
      position:absolute;
      right:14px;
      top:50%;
      transform:translateY(-50%);
      font-size:16px;
      color:#3f4f66;
      pointer-events:none;
    }

    /* Tid-fält med kalender-ikon i fältet */
    .timeIconBtn{
      position:absolute;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      width:34px;
      height:34px;
      border-radius:10px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      display:grid;
      place-items:center;
      box-shadow:0 8px 18px rgba(17,38,78,.06);
    }
    .timeIconBtn:active{transform:translateY(-50%) translateY(1px)}
    .timeIconBtn svg{width:18px;height:18px}

    .rowTitle{
      margin:10px 0 10px;
      font-size:18px;
      font-weight:900;
      color:#183a78;
    }

    .checks{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    .checkItem{
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:18px;
      background:#fbfdff;
    }
    .checkItem input{width:22px;height:22px}
    .checkItem span{font-weight:800}

    .btnGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:14px;
    }
    .bigBtn{
      border:none;
      border-radius:22px;
      padding:16px 14px;
      font-weight:900;
      font-size:18px;
      cursor:pointer;
      background:var(--btn);
      color:var(--btnText);
      box-shadow:0 14px 26px rgba(17,38,78,.12);
    }
    .bigBtn.primary{background:var(--blue); color:#fff}
    .bigBtn.outline{
      background:#fff;
      border:2px solid rgba(31,87,214,.45);
      color:#1f57d6;
    }
    .bigBtn:active{transform:translateY(1px)}

    .priceBox{
      border:2px dashed rgba(107,122,144,.35);
      border-radius:18px;
      padding:14px;
      margin-top:12px;
    }
    .priceLine{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      padding:6px 0;
      color:#25324a;
      font-weight:800;
    }
    .priceLine small{font-weight:700; color:var(--muted)}
    .priceLine strong{font-size:20px}
    .priceLine.emph{
      border-top:1px solid rgba(217,225,239,.85);
      margin-top:6px;
      padding-top:10px;
      font-size:16px;
    }

    .mutedHint{
      margin:8px 0 0;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.35;
    }

    /* Modal */
    .modalBg{
      position:fixed; inset:0;
      background:rgba(12,22,40,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal{
      width:min(560px, 100%);
      background:#fff;
      border-radius:22px;
      border:1px solid rgba(217,225,239,.9);
      box-shadow:0 26px 70px rgba(0,0,0,.25);
      padding:16px;
    }
    .modalHead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:6px;
    }
    .modalHead h3{margin:0; font-size:18px; color:#133a7a}
    .xBtn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      width:38px;height:38px;
      cursor:pointer;
      font-weight:900;
    }
    .otherList{
      margin-top:10px;
      border-top:1px solid rgba(217,225,239,.8);
      padding-top:10px;
      display:grid;
      gap:10px;
    }
    .otherRow{
      display:grid;
      grid-template-columns: 1fr 130px 44px;
      gap:10px;
      align-items:center;
    }
    @media (max-width:520px){
      .otherRow{grid-template-columns: 1fr 110px 44px}
    }
    .trashBtn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      height:46px;
      cursor:pointer;
      font-weight:900;
    }

    /* Print (A4) */
    @media print{
      body{background:#fff}
      .wrap{max-width:none; padding:0}
      .noPrint{display:none !important}
      .printSheet{
        display:block !important;
        padding:0;
      }
    }
    .printSheet{display:none}
    .a4{
      width:210mm;
      min-height:297mm;
      padding:16mm;
      margin:0 auto;
      font-family:-apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      color:#0b1220;
    }
    .a4 .logoRow{
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      margin-bottom:12px;
      border-bottom:2px solid #e6edf8;
      padding-bottom:10px;
    }
    .a4 img{height:42px; object-fit:contain}
    .a4 h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
      color:#113a7a;
      text-align:right;
    }
    .a4 .meta{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px 18px;
      font-size:12.5px;
      color:#1c2b44;
      margin:10px 0 14px;
    }
    .a4 .meta div b{display:inline-block; min-width:120px; color:#0e1a2b}
    .a4 .section{
      border:1px solid #e6edf8;
      border-radius:14px;
      padding:10px 12px;
      margin:10px 0;
    }
    .a4 .section h3{
      margin:0 0 8px;
      font-size:13px;
      color:#113a7a;
      letter-spacing:.2px;
      text-transform:uppercase;
    }
    .a4 .bullets{
      margin:0;
      padding-left:18px;
      font-size:12.5px;
      color:#1c2b44;
      line-height:1.4;
    }
    .a4 .priceTable{
      width:100%;
      border-collapse:collapse;
      margin-top:8px;
      font-size:12.5px;
    }
    .a4 .priceTable td{
      padding:7px 0;
      border-bottom:1px solid #eef3fb;
    }
    .a4 .priceTable td:last-child{text-align:right; font-weight:900}
    .a4 .tot{
      font-size:14px;
      font-weight:900;
      padding-top:10px;
      border-top:2px solid #e6edf8;
    }
    .a4 .note{
      margin-top:10px;
      font-size:11.5px;
      color:#52637a;
      line-height:1.4;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- KUNDUPPGIFTER + MÖTESDATA -->
    <div class="card">
      <div class="headRow">
        <div>
          <h2>Kunduppgifter</h2>
          <p class="sub">Fylls i vid första telefonkontakten och inför kundbesök.</p>
        </div>
        <div class="topBtns noPrint">
          <button class="smallBtn" id="btnReset" type="button">Nollställ</button>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label for="kundnamn">Kundnamn</label>
          <input id="kundnamn" type="text" placeholder="Ex. Anna Andersson" autocomplete="name" />
        </div>
        <div>
          <label for="adress">Adress</label>
          <input id="adress" type="text" placeholder="Gata, postnummer, ort" autocomplete="street-address" />
        </div>
        <div>
          <label for="telefon">Telefon</label>
          <input id="telefon" type="tel" placeholder="" autocomplete="tel" />
        </div>
        <div>
          <label for="epost">E-post</label>
          <input id="epost" type="email" placeholder="" autocomplete="email" />
        </div>
      </div>

      <div class="rowTitle">Mötesdata</div>

      <div class="grid2">
        <div>
          <label>Datum</label>
          <div class="selectBtnWrap">
            <select id="dateSelect" class="selectBtn" aria-label="Datum">
              <option value="" selected>Datum</option>
            </select>
            <span class="chev">▾</span>
          </div>
        </div>

        <div>
          <label>Tid</label>
          <div class="selectBtnWrap">
            <select id="timeSelect" class="selectBtn" aria-label="Tid">
              <option value="" selected>Tid</option>
            </select>
            <span class="chev">▾</span>

            <!-- Kalender-ikon i tidfältet -->
            <button class="timeIconBtn noPrint" id="btnCalendar" type="button" title="Lägg till i kalender">
              <svg viewBox="0 0 24 24" fill="none" stroke="#20314b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <rect x="3" y="4" width="18" height="18" rx="3"></rect>
                <line x1="16" y1="2.5" x2="16" y2="6"></line>
                <line x1="8" y1="2.5" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
            </button>
          </div>
        </div>

        <div>
          <label>Mötestyp</label>
          <div class="selectBtnWrap">
            <select id="motestyp" class="selectBtn">
              <option value="" selected>Ej valt</option>
              <option>Första besök</option>
              <option>Återbesök</option>
              <option>Telefonmöte</option>
              <option>Teams/Online</option>
            </select>
            <span class="chev">▾</span>
          </div>
        </div>

        <div>
          <label>Plats</label>
          <input id="plats" type="text" placeholder="Hos kund, adress eller Teams-länk" />
        </div>

        <div class="checkItem" style="grid-column:1 / span 1;">
          <input id="rotCheck" type="checkbox" />
          <span>Kund vill utnyttja ROT</span>
        </div>
        <div>
          <label for="rotBelopp">Belopp (ROT)</label>
          <input id="rotBelopp" type="number" inputmode="numeric" min="0" step="100" value="0" />
        </div>
      </div>

      <p class="mutedHint noPrint">
        Tips: allt sparas automatiskt i telefonen (så du kan öppna kamera och gå tillbaka utan att tappa data).
      </p>
    </div>

    <!-- BADRUMSDATA -->
    <div class="card">
      <div class="headRow">
        <div>
          <h2>Badrumsdata</h2>
          <p class="sub">Valen används för pris + sammanfattning.</p>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>Nivå</label>
          <div class="selectBtnWrap">
            <select id="niva" class="selectBtn">
              <option value="" selected>Ej valt</option>
              <option value="Standard">Standard</option>
              <option value="Premium">Premium</option>
              <option value="Exclusive">Exclusive</option>
            </select>
            <span class="chev">▾</span>
          </div>
        </div>

        <div>
          <label>Storlek (m²)</label>
          <div class="selectBtnWrap">
            <select id="yta" class="selectBtn">
              <option value="" selected>Ej valt</option>
            </select>
            <span class="chev">▾</span>
          </div>
        </div>

        <div>
          <label>Takhöjd (m)</label>
          <div class="selectBtnWrap">
            <select id="takh" class="selectBtn">
              <option value="" selected>Ej valt</option>
            </select>
            <span class="chev">▾</span>
          </div>
        </div>

        <div>
          <label>Reserv</label>
          <div class="selectBtnWrap">
            <select id="reserv" class="selectBtn">
              <option value="" selected>Ej valt</option>
              <option value="0">0</option>
              <option value="5000">5 000</option>
              <option value="10000">10 000</option>
              <option value="15000">15 000</option>
            </select>
            <span class="chev">▾</span>
          </div>
        </div>
      </div>
    </div>

    <!-- FUNKTIONER & UTRUSTNING -->
    <div class="card">
      <div class="headRow">
        <div>
          <h2>Funktioner & utrustning</h2>
          <p class="sub">Bocka i för info till entreprenören och/eller prispåslag.</p>
        </div>
      </div>

      <div class="checks">
        <div class="checkItem"><input id="wcVagg" type="checkbox"><span>Vägghängd WC</span></div>
        <div class="checkItem"><input id="wcGolv" type="checkbox"><span>Golvstående WC</span></div>
        <div class="checkItem"><input id="handdusch" type="checkbox"><span>Handdusch vid toalett</span></div>
        <div class="checkItem"><input id="badkar" type="checkbox"><span>Badkar</span></div>
        <div class="checkItem"><input id="enbartDusch" type="checkbox"><span>Enbart dusch</span></div>

        <!-- Flyttade upp enligt din bild (3 knappar) -->
        <div class="checkItem"><input id="tvattmaskin" type="checkbox"><span>Tvättmaskin inkl el & avlopp</span></div>
        <div class="checkItem"><input id="sanktInnertak" type="checkbox"><span>Sänkt innertak</span></div>
        <div class="checkItem"><input id="behallaDorTroskel" type="checkbox"><span>Behålla befintlig dörr och tröskel</span></div>

        <div class="checkItem"><input id="spackelMal" type="checkbox"><span>Spackling & målning</span></div>
        <div class="checkItem"><input id="nyDor" type="checkbox"><span>Ny dörr</span></div>
        <div class="checkItem"><input id="nyTroskel" type="checkbox"><span>Ny tröskel</span></div>

        <div class="grid2" style="margin-top:6px;">
          <div>
            <label>Flytt av avlopp</label>
            <div class="selectBtnWrap">
              <select id="flyttAvlopp" class="selectBtn">
                <option value="0" selected>Nej</option>
                <option value="10000">Träbjälklag</option>
                <option value="20000">Betongbjälklag</option>
              </select>
              <span class="chev">▾</span>
            </div>
          </div>

          <div>
            <label>Övrigt</label>
            <button class="selectBtn" id="btnOther" type="button">Lägg till poster</button>
          </div>
        </div>

        <div class="checkItem"><input id="hamtaKakel" type="checkbox"><span>Vi hämtar kakel & klinker åt kund (+5 000)</span></div>
        <div class="checkItem"><input id="hamtaInredning" type="checkbox"><span>Vi hämtar badrumsinredning åt kund (+5 000)</span></div>
      </div>
    </div>

    <!-- PRIS + SAMMANFATTNING -->
    <div class="card">
      <div class="headRow">
        <div>
          <h2>Preliminärt pris & sammanfattning</h2>
          <p class="sub">Priser är preliminära. Slutlig offert tas fram av entreprenören.</p>
        </div>
      </div>

      <div class="priceBox" id="priceBox">
        <div class="priceLine"><span>Delsumma (exkl. moms, inkl. 10% höjning)</span><strong id="sumEx">0 kr</strong></div>
        <div class="priceLine"><span>ROT-avdrag</span><strong id="rotOut">0 kr</strong></div>
        <div class="priceLine emph"><span>Pris efter ROT-avdrag (exkl. moms)</span><strong id="afterRotEx">0 kr</strong></div>
        <div class="priceLine"><small>Pris efter ROT-avdrag (inkl. moms)</small><strong id="afterRotInc">0 kr</strong></div>
        <div class="mutedHint">Texten ovan visar tydligt att priset är efter ROT-avdrag.</div>
      </div>

      <div class="grid2" style="margin-top:14px;">
        <div>
          <label>Sammanfattning (kund + entreprenör)</label>
          <textarea id="summaryExtra" placeholder="Ex. särskilda förutsättningar, tidsfönster, noteringar etc."></textarea>
        </div>
        <div>
          <label>Visning / kopiera</label>
          <textarea id="summaryOut" readonly placeholder="Tryck Beräkna pris så genereras sammanfattning här."></textarea>
        </div>
      </div>

      <div class="btnGrid noPrint">
        <button class="bigBtn primary" id="btnCalc" type="button">Beräkna pris</button>
        <button class="bigBtn" id="btnCopy" type="button">Kopiera sammanfattning</button>
        <button class="bigBtn" id="btnSave" type="button">Spara</button>
        <button class="bigBtn outline" id="btnPdf" type="button">Spara som PDF</button>
      </div>

      <p class="mutedHint noPrint">
        “Spara” och “Spara som PDF” öppnar en A4-sida. På iPhone väljer du Dela → Spara i Filer → iCloud Drive (delad mapp).
      </p>
    </div>

    <!-- PRINT SHEET -->
    <div class="printSheet" id="printSheet">
      <div class="a4" id="a4">
        <div class="logoRow">
          <img id="logoImg" alt="PETRA" src="https://petrabadrum.github.io/petrabadrum/Petra%20Bygg.jpeg" />
          <h1>PETRABADRUM – Offertunderlag</h1>
        </div>

        <div class="meta" id="metaBlock"></div>

        <div class="section">
          <h3>Val & information</h3>
          <ul class="bullets" id="bullets"></ul>
        </div>

        <div class="section">
          <h3>Noteringar</h3>
          <div id="notes" style="font-size:12.5px; color:#1c2b44; line-height:1.4;"></div>
        </div>

        <div class="section">
          <h3>Pris (efter ROT-avdrag)</h3>
          <table class="priceTable">
            <tbody id="priceParts"></tbody>
            <tr>
              <td class="tot">Uppskattat pris efter ROT-avdrag (exkl. moms)</td>
              <td class="tot" id="totAfterRotEx">0 kr</td>
            </tr>
          </table>
          <div class="note">
            Etablering = 5% av totalen, Arbetskostnad = 55%, Materialkostnad = 40%.<br/>
            Delsumman är beräknad med 10% prisjustering exkl. moms. Slutlig offert tas fram av entreprenör.
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- MODAL: Övrigt-poster -->
  <div class="modalBg noPrint" id="modalBg" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalHead">
        <h3>Övrigt – lägg till poster</h3>
        <button class="xBtn" id="btnCloseModal" type="button">✕</button>
      </div>

      <div class="grid2">
        <div>
          <label>Beskrivning</label>
          <input id="otherDesc" type="text" placeholder="Ex. Byta fönster / Bygga in badkar" />
        </div>
        <div>
          <label>Belopp (kr)</label>
          <input id="otherAmt" type="number" inputmode="numeric" min="0" step="100" placeholder="0" />
        </div>
      </div>

      <div class="btnGrid" style="margin-top:12px;">
        <button class="bigBtn primary" id="btnAddOther" type="button">Lägg till</button>
        <button class="bigBtn" id="btnClearOthers" type="button">Rensa alla</button>
      </div>

      <div class="otherList" id="otherList"></div>

      <p class="mutedHint">
        Poster här räknas med i priset och visas i sammanfattning/PDF.
      </p>
    </div>
  </div>

  <script>
    /* -------------------------
       Grunddata / Priser
       ------------------------- */

    // Priser (exkl moms) – sedan +10% på totalen enligt instruktion.
    // Du kan justera här när du vill.
    const prices = {
      // exempel – håll dessa enkla
      tvattmaskin: 0,        // du har inte angivit pris, lämnas 0 om det bara är info
      sanktInnertak: 0,      // okänt pris -> 0
      spackelMal: 0,         // okänt pris -> 0
      nyDor: 0,              // om du vill: lägg pris här
      nyTroskel: 0,          // om du vill: lägg pris här
      flyttAvloppTra: 10000,
      flyttAvloppBetong: 20000,
      hamta: 5000
    };

    const PRICE_UPLIFT = 1.10; // +10%

    /* -------------------------
       Helpers
       ------------------------- */
    const kr = (n) => {
      const x = Math.round(Number(n || 0));
      return x.toLocaleString('sv-SE') + " kr";
    };

    const qs = (id) => document.getElementById(id);

    function setChosenState(el){
      const v = (el.value ?? "").toString().trim();
      // “Ej valt” markeras som inte valt
      const notChosen = (v === "" || v === "Ej valt" || v === "0" && el.id !== "flyttAvlopp");
      el.dataset.chosen = notChosen ? "0" : "1";
    }

    function buildDateOptions(){
      const sel = qs("dateSelect");
      const today = new Date();
      for(let i=0;i<45;i++){
        const d = new Date(today);
        d.setDate(today.getDate()+i);
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth()+1).padStart(2,"0");
        const dd = String(d.getDate()).padStart(2,"0");
        const label = `${dd}/${mm}/${yyyy}`;
        const opt = document.createElement("option");
        opt.value = label;
        opt.textContent = label;
        sel.appendChild(opt);
      }
    }

    function buildTimeOptions(){
      const sel = qs("timeSelect");
      for(let h=7; h<=20; h++){
        for(let m=0; m<60; m+=15){
          const HH = String(h).padStart(2,"0");
          const MM = String(m).padStart(2,"0");
          const t = `${HH}:${MM}`;
          const opt = document.createElement("option");
          opt.value = t;
          opt.textContent = t;
          sel.appendChild(opt);
        }
      }
    }

    function buildYtaOptions(){
      const sel = qs("yta");
      for(let i=2; i<=20; i++){
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = `${i} m²`;
        sel.appendChild(opt);
      }
    }

    function buildTakhOptions(){
      const sel = qs("takh");
      for(let x=2.0; x<=3.0+1e-9; x+=0.1){
        const v = x.toFixed(1).replace(".", ",");
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = `${v} m`;
        sel.appendChild(opt);
      }
    }

    /* -------------------------
       LocalStorage (så inget försvinner)
       ------------------------- */
    const STORE_KEY = "petrabadrum_v_fast";

    function collectState(){
      const ids = [
        "kundnamn","adress","telefon","epost",
        "dateSelect","timeSelect","motestyp","plats",
        "rotCheck","rotBelopp",
        "niva","yta","takh","reserv",
        "wcVagg","wcGolv","handdusch","badkar","enbartDusch",
        "tvattmaskin","sanktInnertak","behallaDorTroskel",
        "spackelMal","nyDor","nyTroskel",
        "flyttAvlopp","hamtaKakel","hamtaInredning",
        "summaryExtra",
      ];

      const s = {};
      ids.forEach(id=>{
        const el = qs(id);
        if(!el) return;
        if(el.type === "checkbox") s[id] = el.checked ? 1 : 0;
        else s[id] = el.value ?? "";
      });
      s.otherItems = otherItems.slice();
      return s;
    }

    function applyState(s){
      if(!s) return;
      Object.keys(s).forEach(id=>{
        if(id==="otherItems") return;
        const el = qs(id);
        if(!el) return;
        if(el.type === "checkbox") el.checked = !!s[id];
        else el.value = s[id];
      });
      otherItems = Array.isArray(s.otherItems) ? s.otherItems : [];
      refreshOtherList();
      refreshChosen();
    }

    function saveState(){
      try{
       